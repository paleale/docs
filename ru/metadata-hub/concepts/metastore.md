---
title: Кластеры {{ metastore-full-name }}
description: В сервисе {{ metadata-hub-full-name }} вы можете создавать кластеры {{ metastore-full-name }}.
---

# Кластеры {{ metastore-full-name }}

{% include [Preview](../../_includes/note-preview.md) %}

{% include [connection](../../_includes/metadata-hub/metastore-definition.md) %}

## Назначение {{ metastore-full-name }} {#metastore-objectives}

При работе с большими данными и аналитикой в облаке часто возникает вопрос о преобразовании наборов файлов в таблицы, с которыми удобно работать через SQL. {{ metastore-name }} представляет собой _персистентную_ базу данных со словарем данных. Персистентность означает, что информация сохраняется на диск и остается доступной после выключения компьютера или перезапуска системы. Словарь данных содержит набор определений, описывающих структуру и формат данных. {{ metastore-name }} хранит метаданные о таблицах, физически расположенных в {{ objstorage-full-name }}. В нем содержится информация о местоположении файлов с данными, их организации, структуре колонок, типах данных, партиционировании и других аспектах. По сути, {{ metastore-name }} создает абстракцию над сырыми файлами, преобразуя их в логические таблицы для работы через SQL.

Это можно сравнить с каталогизацией книг в библиотеке. В большой библиотеке с тысячами книг без каталога пришлось бы проверять все полки в поисках нужной книги. Каталог позволяет быстро определить точное местоположение книги. {{ metastore-name }} выполняет аналогичную функцию для данных в {{ objstorage-name }}.

В [реляционных базах данных](../../glossary/relational-databases.md) (Oracle, {{ PG }}) словарь данных встроен в саму СУБД. При создании таблицы в {{ PG }} информация о ее структуре сохраняется в системных таблицах внутри той же базы данных. Однако в экосистеме больших данных, где файлы могут храниться отдельно от средств их обработки, требуется отдельный сервис для хранения этой информации — {{ metastore-name }}.

## Сценарии использования {#scenarios}

{{ metastore-name }} сам по себе не решает бизнес-задачи, но становится необходимым инструментом в определенных сценариях использования. 

### Работа с данными из разных аналитических инструментов {#analytic-tools}

В современных архитектурах обработки данных часто используется несколько инструментов для работы с одними и теми же данными в {{ objstorage-name }}. Это обусловлено тем, что разные инструменты оптимальны для различных задач. Например, {{ SPRK }} эффективен для массовой обработки данных и ETL-процессов (Extract, Transform, Load), в то время как {{ TR }} лучше подходит для интерактивной аналитики и быстрых запросов.

Без единого кластера каждый инструмент будет поддерживать собственную копию метаданных, что создает проблемы при изменении структуры данных. При добавлении новой колонки в таблицу и обновлении метаданных в {{ SPRK }}, без соответствующего обновления в {{ TR }}, запросы из {{ TR }} будут возвращать неполные данные или приводить к ошибкам.

{{ metastore-name }} решает эту проблему, предоставляя единый источник истины для всех метаданных. Структура таблицы описывается один раз, и все подключенные инструменты автоматически получают доступ к актуальной информации. Это не только упрощает администрирование, но и значительно снижает риск ошибок из-за несогласованности метаданных.

В ситуации, когда команда аналитиков использует {{ TR }} для интерактивных запросов, а команда инженеров данных применяет {{ SPRK }} для ETL-процессов, единый {{ metastore-name }} обеспечивает согласованность представления данных для обеих команд, гарантируя точность результатов.

### Управление жизненным циклом кластеров { #cluster-lifecycle }

Одно из основных преимуществ облачных вычислений — возможность оплаты только за фактически использованные ресурсы. Это особенно актуально для задач обработки данных с периодическим характером.

В {{ yandex-cloud }} многие клиенты используют мощные вычислительные кластеры ({{ dataproc-name }} с {{ SPRK }} или собственные кластеры Apache Hadoop®) только для периодических задач — формирования отчетов, ночных пакетных обработок данных, обновления аналитических моделей и других подобных операций.

Такие кластеры могут включать сотни процессорных ядер и терабайты оперативной памяти, что делает их эксплуатацию дорогостоящей. Постоянное использование таких ресурсов экономически нецелесообразно, особенно если они активно задействованы лишь несколько часов в сутки.

Более эффективный подход заключается в создании кластеров на время выполнения задачи с последующим удалением. Однако в традиционной архитектуре Apache Hadoop® {{ metastore-name }} является частью кластера, и при удалении кластера происходит потеря всех метаданных о таблицах. При следующем запуске потребуется заново определять структуру таблиц, что трудоемко и чревато ошибками.

Отдельный управляемый {{ metastore-name }} решает эту проблему. Он существует независимо от вычислительных кластеров и продолжает хранить все метаданные после удаления кластеров. При создании нового кластера для следующего сеанса обработки он подключается к тому же {{ metastore-name }} и получает доступ ко всем определениям таблиц.

В {{ yandex-cloud }} многие пользователи реализуют подобный сценарий через {{ maf-short-name }} — сервис для оркестрации рабочих процессов. {{ maf-short-name }} по расписанию создает мощные кластеры {{ dataproc-name }} для обработки данных, а после завершения расчетов удаляет их для оптимизации затрат. Все метаданные сохраняются в отдельном управляемом {{ metastore-name }}, обеспечивая бесшовный процесс для пользователей.

### Работа с современными форматами данных для аналитики { #analytic-tasks }

В последние годы появились новые форматы данных, специально разработанные для аналитических задач: Apache Iceberg, Delta Lake, Apache Hudi. Эти форматы значительно превосходят традиционные (CSV или Parquet) по функциональности и удобству использования.
Они обеспечивают следующие возможности:

* атомарные транзакции при записи данных;
* контроль версий данных и путешествие во времени (time travel);
* схематизация и эволюция схемы;
* оптимизация таблиц и управление их компактностью;
* изоляция запросов от параллельных записей.

Для реализации этих функций форматы, подобные Iceberg и Delta Lake, требуют централизованного управления метаданными. Им необходимо хранилище для информации о версиях таблиц, транзакциях, изменениях схемы и других аспектах. {{ metastore-name }} предоставляет оптимальную инфраструктуру для этой цели.

Без {{ metastore-name }} работа с этими продвинутыми форматами была бы значительно сложнее, а некоторые функции вообще были бы недоступны. С {{ metastore-name }} доступны все преимущества современных форматов данных без необходимости создания собственной инфраструктуры для управления метаданными.

В {{ yandex-cloud }} {{ metastore-name }} особенно полезен при создании озер данных ([Data Lake](../../glossary/datalake.md)) и озер аналитических данных (Data Lakehouse) с использованием форматов Delta Lake и Iceberg. Он обеспечивает необходимую инфраструктуру для хранения метаданных этих форматов, делая их использование простым и надежным.

## Интеграция {{ metastore-name }} с сервисами {{ yandex-cloud }} {#integrations}

В {{ yandex-cloud }} {{ metastore-name }} интегрируется с другими сервисами, расширяя их возможности для работы с данными и упрощая создание комплексных решений.

### {{ dataproc-name }} и {{ metastore-name }} {#data-processing}

[{{ dataproc-name }}](../../data-proc/concepts/index.md) — это сервис для запуска распределенных вычислений на базе [{{ SPRK }}](https://spark.apache.org/), [Apache Hive](https://hive.apache.org/) и других инструментов экосистемы Apache Hadoop®. {{ SPRK }} активно использует {{ metastore-name }} для хранения схем таблиц и доступа к данным через SQL-интерфейс.

Подключение {{ dataproc-name }} к управляемому {{ metastore-name }} в {{ yandex-cloud }} осуществляется просто: при создании кластера указывается URI {{ metastore-name }} в дополнительных настройках. После этого {{ SPRK }} автоматически подключается к {{ metastore-name }} и получает доступ ко всем определенным в нем таблицам.

Это открывает широкие возможности для работы с данными:

* использование SparkSQL для выполнения сложных аналитических запросов к данным в {{ objstorage-name }};
* работа разных кластеров {{ dataproc-name }} с одними и теми же таблицами без дублирования определений;
* создание и удаление кластеров по мере необходимости без потери метаданных о таблицах.

Например, {{ dataproc-name }} может использоваться для создания ETL-пайплайнов, которые читают данные из различных источников, преобразуют их и записывают в таблицы, определенные в {{ metastore-name }}. Затем эти данные будут доступны для аналитики через любой другой сервис, подключенный к тому же {{ metastore-name }}.

### {{ mtr-short-name }} и {{ metastore-name }} {#managed-trino}

{{ TR }} — это распределенный SQL-движок для аналитических запросов, который может работать с различными источниками данных, включая файлы в {{ objstorage-name }}. В {{ yandex-cloud }} доступен сервис [{{ mtr-short-name }}](../../managed-trino/quickstart.md) с возможностью подключения к {{ metastore-name }}.

{{ TR }} использует систему коннекторов для доступа к различным источникам данных. Для работы с данными через {{ metastore-name }} применяется коннектор Hive. При [создании кластера {{ mtr-short-name }}](../../managed-trino/operations/cluster-create.md) можно добавить каталог с типом **Hive** и указать URI {{ metastore-name }}, после чего {{ TR }} получит доступ ко всем таблицам, определенным в {{ metastore-name }}.

Интеграция {{ mtr-short-name }} с {{ metastore-name }} особенно полезна для интерактивной аналитики. Аналитики могут выполнять SQL-запросы к данным в {{ objstorage-name }} без знания деталей их физического хранения. Они работают с абстракцией таблиц, а {{ metastore-name }} и {{ TR }} обеспечивают все аспекты, связанные с доступом к данным.

Например, бизнес-аналитик может подключиться к {{ mtr-short-name }} через {{ websql-name }} или BI-инструмент, выполнить сложный аналитический запрос к данным, загруженным и обработанным через {{ dataproc-name }}, и получить результаты за несколько секунд. При этом не требуется знать физическое местоположение файлов, методы их партиционирования и формат записи — всю эту информацию {{ TR }} получает из {{ metastore-name }}.

## Текущие особенности работы с {{ metastore-name }} {#current-implementation}

На текущий момент при работе с управляемым {{ metastore-name }} в {{ yandex-cloud }} существует несколько важных особенностей, которые необходимо учитывать при проектировании и развертывании решений.

Первая особенность связана с доступностью сервиса. В настоящее время {{ metastore-name }} работает только с объектными хранилищами внутри {{ yandex-cloud }} и не поддерживает подключение к внешним S3-совместимым хранилищам. Это означает невозможность использования для работы с данными, хранящимися, например, в Amazon S3 или MinIO, развернутом в собственном дата-центре.

Кроме того, {{ metastore-name }} доступен только по внутреннему IP-адресу в виртуальной частной сети (VPC) и не имеет публичного DNS-имени. Это обеспечивает дополнительную безопасность, но требует, чтобы все сервисы, подключающиеся к {{ metastore-name }}, находились в той же VPC или имели настроенный сетевой доступ.

Вторая особенность касается сетевой безопасности. Для корректной работы {{ metastore-name }} необходима правильная настройка групп безопасности, разрешающих необходимый сетевой трафик. Без этого кластер может отображаться в состоянии `DEAD`, что затрудняет диагностику проблем (см. [инструкцию](../../metadata-hub/operations/metastore/configure-security-group.md) по настройке групп безопасности).

Подробнее о {{ metastore-name }} см. в [документации Apache®](https://cwiki.apache.org/confluence/display/hive/design#Design-Metastore).

## Примеры использования {#examples}

* [{#T}](../tutorials/metastore-import.md)
* [{#T}](../tutorials/sharing-tables.md)
